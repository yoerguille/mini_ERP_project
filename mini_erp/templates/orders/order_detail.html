{% extends "general/layout.html" %}

{% block head_title %} Bienvenido a la Home {% endblock %}

{% block contenido %}

{% load static %}

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="{% static 'orders/css/orders.css' %}">

<!--Header-->
<div class="container">
    <div class="order-header">
        <h2>{{ object.title }}</h2>

        <div class="order-meta">

            <a href="{% url 'orders:order_update' object.pk %}" class="btn btn-outline-primary">
                Editar
            </a>

            <span class="order-delivery">
                Entrega: {{ object.delivery_date|date:"d/m/Y" }}
            </span>

            <span>
                <form method="post" action="{% url 'orders:change_status' object.pk %}">
                    {% csrf_token %}
                    <select name="status" class="form-select w-auto" onchange="this.form.submit()">
                        <option disabled selected>Cambiar Estado</option>
                        <option value="PENDING_DESIGN">Pendiente de diseño</option>
                        <option value="DESIGN_READY">Diseño confirmado</option>
                        <option value="IN_PRODUCTION">En producción</option>
                        <option value="COMPLETED">Completado</option>
                        <option value="DELIVERED">Entregado</option>
                        <option value="CANCELLED">Cancelado</option>
                    </select>
                </form>
            </span>

            
            <span class="badge bg-{{ object.status_color }}">
                {{ object.get_status_display }}
            </span>

            <span class="order-total">
                {{ object.total_price }} € + IVA
            </span>
        </div>
    </div>


    <div class="order-info-grid">
        <div class="info-card">
            <strong>Cliente</strong>
            <p>{{ object.client }}</p>
        </div>

        <div class="info-card">
            <strong>Creado</strong>
            <p>{{ object.created_at|date:"d/m/Y" }}</p>
        </div>

        <div class="info-card">
            <strong>Tipo</strong>
            <p>{{ object.get_order_type_display }}</p>
        </div>
    </div>
</div>
<!--Tabla de detalle de pedido-->
<div class="container">
    <table class="table order-items-table">
    <thead>
        <tr>
            <th>Cant.</th>
            <th>Producto</th>
            <th>Variante</th>
            <th>Precio</th>
            <th>--</th>
        </tr>
    </thead>
    <tbody>
        {% for item in object.items.all %}
        <tr>
            <td>{{ item.quantity }}</td>
            <td>{{ item.product }}</td>
            <td>{{ item.variant }}</td>
            <td>{{ item.unit_price }} €</td>
            <td><a href="{% url 'orders:order_item_delete' item.pk %}">
            Eliminar Item
            </a></td>
        </tr>
        {% endfor %}
    </tbody>
    </table>
    <!--Botones de accion -->
    <div class="order-actions">

        <a href="{% url 'orders:order_item' object.pk %}" class="btn btn-outline-primary">
            Añadir artículo
        </a>

        <a href="{% url 'orders:order_delete' object.pk %}" class="btn btn-outline-danger">
            Eliminar
        </a>

        <a href="{% url 'home' %}" class="btn btn-link">
            Volver
        </a>
    </div>
</div>





    


    <div class="container">
        <div class="row">
            <div class="col-md-5">
                <div class="project-info-box mt-0">
                    <h5>Detalles del Encargo</h5>
                    <p class="mb-3">{{ object.notes }}</p>
                </div><!-- / project-info-box -->

                <div class="project-info-box">
                    
                    
                    
                    {% if object.items.exists %}
                        <p class="mb-0"><b>Precio Total:</b> {{ object.total_price }}€ + IVA</p>
                        <p class="mb-0"><b>Total a Pagar:</b> {{ object.total_price_with_vat }}€ IVA incl.</p>
                    {% else %}
                        <p>El pedido no tiene orderitems</p>
                    {% endif %}
                    
                </div><!-- / project-info-box -->

                <div class="project-info-box mt-0 mb-0">
                    <p class="mb-3">
                        <span class="fw-bold mr-10 va-middle hide-mobile">Share:</span>
                        <a href="#x" class="btn btn-xs btn-facebook btn-circle btn-icon mr-5 mb-0"><i class="fab fa-facebook-f"></i></a>
                        <a href="#x" class="btn btn-xs btn-twitter btn-circle btn-icon mr-5 mb-0"><i class="fab fa-twitter"></i></a>
                        <a href="#x" class="btn btn-xs btn-pinterest btn-circle btn-icon mr-5 mb-0"><i class="fab fa-pinterest"></i></a>
                        <a href="#x" class="btn btn-xs btn-linkedin btn-circle btn-icon mr-5 mb-0"><i class="fab fa-linkedin-in"></i></a>
                    </p>
                </div><!-- / project-info-box -->
            </div><!-- / column -->

            

            <div class="col-md-7">
                <img src="https://www.bootdey.com/image/400x300/FFB6C1/000000" alt="project-image" class="rounded">
                <div class="project-info-box">
                    <p><b>Categories:</b> Design, Illustration</p>
                    <p><b>Skills:</b> Illustrator</p>
                </div><!-- / project-info-box -->
            </div><!-- / column -->
        </div>
    </div>

{% endblock %}